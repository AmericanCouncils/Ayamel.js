<!DOCTYPE html> 
<html lang="en">
<head>
	<meta charset="utf-8" > 
	<title>FML Viewer Skeleton</title>
	<link rel="stylesheet" href="main.css" type="text/css" /> 
	<link rel="stylesheet" href="./css/jquery-ui-1.8.16.custom.css"> 
	<script src="./js/jquery-1.6.2.min.js"></script> 
	<script src="./js/jquery-1.6.2.min.js"></script> 
	<script src="./js/jquery-ui-1.8.16.custom.min.js"></script>
	<script src="./WebVTT.js"></script>
	<script src="./Caption.js"></script>
	<script src="./captionWrapper.js"></script>
	<script src="./video.js"></script>
	<script src="./h5Clip.js"></script>
	<script src="./ytClip.js"></script>
	<script src="./flowClip.js"></script>
	<script src="./vimClip.js"></script>
	<script>
	$(function() {
		var left = false, right = false,
			right_bar = document.getElementById("right_frame"),
			left_bar = document.getElementById("left_frame"),
			timeline = $( "#main_time" );
			val=0,i=0,starttime=Date.now();
		
		var cues = parseWebVTT(vtt),
			hidden = cues.map(function(c){return CaptionFromCue(c,wrapper,null);}),
			displayed=[],
			clips,count = 0;
		
		var //Video = Ayamel.Video(),
			Stage = Ayamel.Stage(document.getElementById('v_stage'));
		Stage.addEventListener("timeupdate",function(event){
			var i,time = this.currentTime;
			console.log(count,time);
			time %= 20;
			if(time < 5){
				if(left){
					left = false;
					left_bar.style.width = '1%';
				}
				if(right){
					right = false;
					right_bar.style.width = '1%';
				}
			}else if(time > 5 && time < 10){
				if(!left){
					left = true;
					left_bar.style.width = "25%";
				}
				if(right){
					right = false;
					right_bar.style.width = '1%';
				}
			}else if(time > 10 && time < 15){
				if(!left){
					left = true;
					left_bar.style.width = "25%";
				}
				if(!right){
					right = true;
					right_bar.style.width ="25%";
				}
			}else if(time > 15 && time < 19){
				if(left){
					left = false;
					left_bar.style.width = '1%';
				}
				if(!right){
					right = true;
					right_bar.style.width = "25%";
				}
			}
			for(i=0;i<displayed.length;){
				if(displayed[i].stop <= time || time <= displayed[i].start){
					displayed[i].hide();
					hidden.push(displayed.splice(i,1)[0]);
				}else{i++;}
			}
			for(i=0;i<hidden.length;){
				if(hidden[i].start <= time && time <= hidden[i].stop){
					hidden[i].display(Stage.element);
					displayed.push(hidden.splice(i,1)[0]);
				}else{i++;}
			}
		});
//		Stage.setContent(Video);
		
		Ayamel.InstallPlayers(
			[
				flowPlayerInstall,
				h5PlayerInstall,
				ytPlayerInstall,
				vimeoPlayerInstall
			],function(){

			Stage.PlayList([
				{	srcs:["sintel_trailer.webm"],
					start:10,stop:20,next:20	},
				{	srcs:["BigBuckBunny.ogv"],
					start:100,stop:120,next:20 },
				{	srcs:["sintel_trailer.webm"],
					start:20,stop:60,next:Number.PositiveInfinity}
			]);
			/*clips = [	["bunny.mp4",0,10],
						["http://player.vimeo.com/video/33641450",10,20],
						["http://youtu.be/dkptv_GRm5c",5,10],
						["big_buck_bunny_480p.webm",100,110],
						//["http://youtu.be/dkptv_GRm5c",10,20],
						["sintel_trailer.webm",0,5]
					].map(Function.prototype.apply.bind(Ayamel.Clip,null));*/
			//Video.LoadClip(clips[count]);
			Stage.muted = true;
			//Stage.LoadPlayList(PlayList);
			Stage.Play();
		});
	});
	</script>
</head>
<body style="z-index:0;position:absolute;">
<table id="main_table">
	<tr>
		<td id="left_frame"></td>
		<td id="center_frame">
			<div id="v_stage">
			<!--
				<div class="aspect_dummy" id="center_aspect"></div>
				<div class="aspect_element">
					<div id="center_content">
						<div id="time"></div>
						<video src="BigBuckBunny.ogv" controls="true">
						</video>
					</div>
					<div id="main_controls">
						<div id="main_volume" style="width:10px;"></div>
						<div id="main_time"></div>
						<div id="main_speed"></div>
					</div>
				</div>
			-->
			</div>
		</td>
		<td id="right_frame"></td>
	</tr>
</table>
<script>

	var vtt =
"WEBVTT stuff\n\
\n\
00:00:05.000 --> 00:00:08.040 S:50% A:middle L:10%\n\
I dabble? Listen to me. What a <i>jerk</i>.\n\
\n\
00:00:08.040 --> 00:00:11.440 A:middle L:60%\n\
Yeah, I sort of dabble around,\n\
you know.\n\
\n\
00:00:09.040 --> 00:00:12.440 A:start T:25% L:40%\n\
Yeah, I sort of dabble around,\n\
you know.\n\
\n\
Elephants\n\
00:00:12.042 --> 00:00:15.042 T:0% A:start\n\
Introductory titles are showing on the background of a water pool with fishes\n\
swimming and mechanical objects lying on a stone floor.\n\
\n\
Arduino\n\
00:00:15.750 --> 00:00:19.500 T:100% A:end\n\
- and I said '<b><i>Wow!</b></i> a lot of people are starting to talk about this.<br/>\n\
I should check it out!'\n";
</script>
</body>
</html>